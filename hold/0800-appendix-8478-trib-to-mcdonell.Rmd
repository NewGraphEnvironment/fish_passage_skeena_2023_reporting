---
output: html_document
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 72
---

```{r setup-8478, eval = F}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
source('scripts/packages.R')
source('scripts/tables.R')
source('scripts/moti_climate.R')
source('scripts/functions.R')
```

```{r  load-data-8478}
my_site <- 8478

```

`r fpr::fpr_appendix_title()`

## Site Location {.unnumbered}

PSCIS crossing `r as.character(my_site)` is located `r round(fpr::fpr_my_bcfishpass(col_pull = downstream_route_measure)*0.001, 1)`km
upstream of McDonell Lake on a `r fpr::fpr_my_pscis_info()`. The site is located on `r fpr_my_pscis_info(col_pull = road_name)` and is within the Wet'suwet'en and Gitxsan hereditary territories.

<br>

## Background {.unnumbered}

At crossing `r as.character(my_site)`, `r fpr::fpr_my_pscis_info()` is a
`r fpr::fpr_my_bcfishpass() %>% english::ordinal()` order stream with an
upstream watershed area of approximately
`r fpr::fpr_my_wshd()`km^2^. This stream drains a steep, cold water system, where the elevation ranges from
a maximum of `r fpr::fpr_my_wshd(col = 'elev_max')`m to
`r fpr::fpr_my_wshd(col = 'elev_min')`m near the crossing (Table
\@ref(tab:tab-wshd-8478)).

<br>

```{r tab-wshd-8478, eval = T}
fpr::fpr_table_wshd_sum(site_id = my_site) %>% 
  fpr::fpr_kable(caption_text = paste0('Summary of derived upstream watershed statistics for PSCIS crossing ', my_site, '.'),
           footnote_text = 'Elev P60 = Elevation at which 60% of the watershed area is above',
           scroll = F)

```

<br>

A summary of habitat modelling outputs is presented in Table
\@ref(tab:tab-culvert-bcfp-8478). A map of the watershed is provided in
map attachment
[`r fpr::fpr_my_bcfishpass(col_pull = dbm_mof_50k_grid)`](`r fpr::fpr_my_mapsheet(wshd = "kisp", archive_date = "2022-09-06")`).

<br>

```{r tab-culvert-bcfp-8478, eval = T}
fpr::fpr_table_bcfp(scroll = gitbook_on) 
```

<br>

## Climate Change Risk Assessment

Preliminary climate change risk assessment data for the site is presented in Table \@ref(tab:tab-moti-8478).

```{r tab-moti-8478, eval = T}
fpr_table_moti()
```

<br>

<!-- Removed because comments don't have anything to do with climate change risk assessment -->
<!-- # ```{r tab-moti-8478-comments, eval = T} -->
<!-- # fpr_table_moti_comments() -->
<!-- # ``` -->

## Stream Characteristics at Crossing `r as.character(my_site)` {.unnumbered}

At the time of the survey in 2023, PSCIS crossing `r as.character(my_site)` was
un-embedded, non-backwatered and ranked as a
`r fpr::fpr_my_pscis_info(col_pull = barrier_result) %>% stringr::str_to_lower()` to upstream fish passage according to the provincial protocol
[@moe2011Fieldassessment] (Table \@ref(tab:tab-culvert-8478)). Although the culvert was slightly undersized for the size of the stream, it was equipped to handle major flows and was in good condition. Water temperature was `r fpr::fpr_my_habitat_info(loc = "ds", col_pull = 'temperature_c')`$^\circ$C,
pH was `r fpr::fpr_my_habitat_info(loc = "ds", col_pull = 'p_h')` and
conductivity was `r fpr::fpr_my_habitat_info(loc = "ds", col_pull = 'conductivity_m_s_cm')`uS/cm.

`r if(identical(gitbook_on, FALSE)){knitr::asis_output("\\pagebreak")}`

<br>

```{r tab-culvert-8478, eval = T}
fpr::fpr_table_cv_summary_memo()

```


```{r eval=F}
##this is useful to get some comments for the report
hab_site %>% filter(site == my_site & location == 'ds') %>% pull(comments)
hab_site %>% filter(site == my_site & location == 'us') %>% pull(comments)

```

## Stream Characteristics Downstream {.unnumbered}

<!-- 8478_ds says abundant gravels but the ef sites say limited gravels so not too sure what to go with here -->
`r fpr_my_survey_dist(loc = 'ds')`. `r fpr_my_habitat_paragraph(loc = 'ds')` The stream was steep with high flows and few areas with gravels suitable for spawning `r if(gitbook_on){knitr::asis_output("(Figure \\@ref(fig:photo-8478-01)).")}else(knitr::asis_output("(Figure \\@ref(fig:photo-8478-d01))."))` There were few deep pools but fish were still present. Surveyors observed some small cascades with shallow outlet pools. The habitat was rated as `r fpr::fpr_my_priority_info(loc = 'ds') %>% stringr::str_to_lower()` value for salmonid rearing and spawning. 

<br>

## Stream Characteristics Upstream {.unnumbered}

`r fpr_my_survey_dist(loc = 'us')``r if(gitbook_on){knitr::asis_output("(Figure \\@ref(fig:photo-8478-02)).")}else(knitr::asis_output("(Figure \\@ref(fig:photo-8478-d01))."))` `r fpr_my_habitat_paragraph(loc = 'us')` The stream was again steep with high flows. There were periodic cascades, some created by large woody debris protruding over the channel, with the majority less than 1m in height. Deep pools were sparse excepts at the cascade outlets, and areas with spawning gravels were limited. The habitat was rated as `r fpr::fpr_my_priority_info(loc = 'us') %>% stringr::str_to_lower()` for salmonid rearing and spawning.

<br>


## Fish Sampling {.unnumbered}

During the 2023 survey, electrofishing was conducted at three sites below and one site above crossing `r as.character(my_site)`, with results summarised in Tables \@ref(tab:tab-fish-site-8478) - \@ref(tab:tab-fish-dens-8478) and Figure
\@ref(fig:plot-fish-box-8478). A total of `r tab_fish_summary %>% filter(site_id == paste0(my_site, '_us')) %>% group_by(site_id) %>% janitor::adorn_totals() %>% filter(site_id == 'Total') %>% pull(count_fish)` fish were captured upstream and `r tab_fish_summary %>% filter(site_id == paste0(my_site, '_ds')) %>% group_by(site_id) %>% janitor::adorn_totals() %>% filter(site_id == 'Total') %>% pull(count_fish)` fish were captured downstream, all of which were dolly varden `r if(gitbook_on){knitr::asis_output("(Figures \\@ref(fig:photo-8478-03) - \\@ref(fig:photo-8478-04)).")}else(knitr::asis_output("(Figures \\@ref(fig:photo-8478-d02))."))` All fish captured with a fork length greater than 60mm were tagged with Passive Integrated Transponders (PIT tags) with data stored [here](`r paste0(params$repo_url, "blob/main/data/2023/habitat_confirmations.xls")`).

Multiple fish captured at this site displayed usual colouring on their gill plates, suggesting they could have been exposed metal contamination. There was a silver mine downstream with was sporatically active from 1922-1950, on the south-west slope of Hudson Bay Mountain, roughly 12 km west of Smithers on the Mcdonell lake fsr (54.77306,-127.35722). Investigations in 1982-1983 found that the tailing pond, containing high concentration of arsenic, iron, aluminum and lead, was leaking and causing contamination in several creeks that flow into Aldrich Lake. Sampling in 1993 found that the tailings were still generating acid rock drainage (ARD). Aldrich lake is part of the headwaters to the Zymoetz river, and is only approximately 7 km upstream of the PSCIS crossing `r as.character(my_site)` on the `r fpr::fpr_my_pscis_info()`. Fish accessing `r fpr::fpr_my_pscis_info()` could be exposed to these contaminants.

Need to put reference into zotero still but here for now, https://psf.ca/wp-content/uploads/2021/10/Download-PDF561-1.pdf

<br>

## Structure Remediation and Cost Estimate {.unnumbered}

Should restoration/maintenance activities proceed, replacement of PSCIS
crossing `r as.character(my_site)` with a bridge
(`r fpr::fpr_my_pscis_info(col_pull = recommended_diameter_or_span_meters)`m
span) is recommended. The cost of the work is estimated at
\$`r format(fpr::fpr_my_cost_estimate(), big.mark = ',')` for a cost
benefit of `r fpr::fpr_my_cost_estimate(col_pull = cost_net)` linear
m/\$1000 and `r fpr::fpr_my_cost_estimate(col_pull = cost_area_net)`
m^2^/\$1000 with the relatively high costs of the work predicted primarily related to the large amount of road fill present at the site and the subsequent significant excavation required to install the large replacement structure.

<br>

## Conclusion {.unnumbered}




`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak")`

<br>

```{r tab-habitat-summary-8478}
tab_hab_summary %>% 
  filter(Site  == my_site) %>% 
  # select(-Site) %>% 
  fpr::fpr_kable(caption_text = paste0('Summary of habitat details for PSCIS crossing ', my_site, '.'),
                 scroll = F) 

```

<br>

```{r tab-fish-site-8478, eval=T}
fpr_table_fish_site(dat = tab_fish_sites_sum, sit = my_site)

```

<br>

```{r tab-fish-dens-8478, eval=T}
fpr_table_fish_density(dat = fish_abund, sit = my_site)

```

`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak")`

```{r plot-fish-box-8478, fig.cap= my_caption, eval=T}
my_caption <- paste0('Densites of fish (fish/100m2) captured upstream and downstream of PSCIS crossing ', my_site, '.')

fpr_plot_fish_box(dat = fish_abund, sit = my_site) 

```

<br>

```{r photo-8478-01-prep, eval=T}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = 'ds_typical_1_')

my_caption1 = paste0('Typical habitat downstream of PSCIS crossing ', my_site, '.')


```

```{r photo-8478-01, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
knitr::include_graphics(my_photo1)
```

<br>

```{r photo-8478-02-prep, eval=T}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = 'us_typical_2')

my_caption2 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')


```

```{r photo-8478-02, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
knitr::include_graphics(my_photo2)
```

```{r photo-8478-d01, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```

<br>

<!-- ```{r photo-8529-01-prep, eval=T} -->
<!-- my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = 'us2_typical_2') -->

<!-- my_caption1 = paste0('Typical habitat upstream of PSCIS crossing ', my_site2, '.') -->


<!-- ``` -->

<!-- ```{r photo-8529-01, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on} -->
<!-- knitr::include_graphics(my_photo1) -->
<!-- ``` -->

<!-- <br> -->

<!-- ```{r photo-8529-02-prep} -->
<!-- my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_us2_typical_1') -->

<!-- my_caption2 = paste0('Typical habitat upstream of PSCIS crossing ', my_site2, '.') -->
<!-- ``` -->

<!-- ```{r photo-8529-02, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on} -->
<!-- knitr::include_graphics(my_photo2) -->
<!-- ``` -->

<!-- # ```{r photo-8529-d01, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)} -->
<!-- #  -->
<!-- # my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2) -->
<!-- #  -->
<!-- # knitr::include_graphics(my_photo1) -->
<!-- # knitr::include_graphics("fig/pixel.png") -->
<!-- # knitr::include_graphics(my_photo2) -->
<!-- # ``` -->

<br>

```{r photo-8478-03-prep}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = 'fish1')

my_caption1 = paste0('Rainbow trout captured downstream of crossing ', my_site, '.')
```

```{r photo-8478-03, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
knitr::include_graphics(my_photo1)
```

<br>

```{r photo-8478-04-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = 'fish2')

my_caption2 = paste0('Dolly varden captured upstream of crossing ', my_site, '.')

```

```{r photo-8478-04, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
knitr::include_graphics(my_photo2)
```

```{r photo-8478-d02, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```

